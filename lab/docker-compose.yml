version: '3.8'

services:
  orchestrator:
    build:
      context: ..
      dockerfile: lab/Dockerfile.c2
    container_name: hydra-c2-lab
    # Essential for the tview TUI to function and stay alive
    tty: true
    stdin_open: true
    networks:
      hydra_net:
        ipv4_address: 10.5.0.5
    # Required for ICMP (Tier 4) and DNS/NTP (Tier 6/5) binding
    cap_add:
      - NET_RAW
      - NET_ADMIN
    ports:
      - "8080:8080" # HTTPS/Cloud Tiers
      - "53:53/udp" # DNS Tier
      - "123:123/udp" # NTP Tier
    restart: on-failure

  target-alpha:
    build:
      context: ..
      dockerfile: lab/Dockerfile.agent
    container_name: hydra-agent-alpha
    networks:
      hydra_net:
        ipv4_address: 10.5.0.10
    cap_add:
      - NET_RAW
      - NET_ADMIN
    environment:
      - AWS_ACCESS_KEY_ID=AKIA_HYDRA_TEST_DATA # Mock loot for Phase 3.3
    depends_on:
      - orchestrator

networks:
  hydra_net:
    driver: bridge
    ipam:
      config:
        - subnet: 10.5.0.0/24